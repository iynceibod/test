<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–°–ø–∏—Å–æ–∫ –º–æ–¥–µ—Ä–æ–≤</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body { background: #111; color: #fff; font-family: sans-serif; padding: 20px; }
        h1 { text-align: center; }
        h2 { margin-top: 20px; }
        ul { list-style: none; padding: 0; }
        li { margin: 5px 0; }
        a { color: #4fc3f7; text-decoration: none; }
    </style>
</head>
<body>
<h1>‚öîÔ∏è –°–ø–∏—Å–æ–∫ –º–æ–¥–µ—Ä–∞—Ü–∏–∏ Yava ‚öîÔ∏è</h1>
<div id="moders"></div>

<script>
    const tg = window.Telegram.WebApp;

    // –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ —É –±–æ—Ç–∞
    tg.ready();
    tg.expand();

    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –≤ –±–æ—Ç–∞ (—ç—Ç–æ –≤—ã–∑–æ–≤–µ—Ç handle_web_app_data)
    tg.sendData("get_moders");

    // –°–ª—É—à–∞–µ–º –æ—Ç–≤–µ—Ç ‚Äî —Ç—ã –º–æ–∂–µ—à—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å postMessage + JSON.stringify, –µ—Å–ª–∏ —Ö–æ—á–µ—à—å –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –≤—Å—ë —Å—Ä–∞–∑—É
    window.addEventListener("message", function(event) {
        const data = event.data;

        const container = document.getElementById("moders");
        for (const [group, moders] of Object.entries(data.grouped)) {
            const section = document.createElement("div");
            section.innerHTML = `<h2>${group}</h2>`;
            const ul = document.createElement("ul");

            moders.forEach(m => {
                const li = document.createElement("li");
                if (m.nick.link) {
                    li.innerHTML = `üìå <a href="${m.nick.link}" target="_blank">${m.nick.text}</a> [${m.role}]`;
                } else {
                    li.innerHTML = `üìå ${m.nick.text} [${m.role}]`;
                }
                ul.appendChild(li);
            });

            section.appendChild(ul);
            container.appendChild(section);
        }

        const stats = document.createElement("p");
        stats.innerHTML = `<br><b>üìë –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–æ–¥–µ—Ä–∞—Ü–∏–∏:</b> ${data.total}<br>
                           <b>üìÉ –ë–µ–∑ —É—á–µ—Ç–∞ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–∞:</b> ${data.up_to_3}`;
        container.appendChild(stats);
    });
</script>
</body>
</html>
