<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</title>
  <style>
    /* –í–∞—à–∏ —Å—Ç–∏–ª–∏ */
  </style>
</head>
<body>
  <form id="regForm">
    <h2>ü¶ñ –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h2>
    <input type="text" id="nick" placeholder="–í–∞—à –Ω–∏–∫" required>
    <input type="text" id="fa" placeholder="–§–æ—Ä—É–º–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç" required>
    <input type="text" id="discord_id" placeholder="Discord ID" required>
    <input type="number" id="vozrast" placeholder="–í–æ–∑—Ä–∞—Å—Ç" required>
    <input type="text" id="gorod" placeholder="–ì–æ—Ä–æ–¥" required>
    <button type="submit">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
  </form>

  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <script>
    const tg = window.Telegram.WebApp;
    const urlParams = new URLSearchParams(window.location.search);
    const userId = urlParams.get('user_id');

    tg.expand();
    tg.enableClosingConfirmation();

    document.getElementById('regForm').addEventListener('submit', function(e) {
      e.preventDefault();
      
      const formData = {
        user_id: userId,
        nick: document.getElementById('nick').value,
        fa: document.getElementById('fa').value,
        discord_id: document.getElementById('discord_id').value,
        vozrast: document.getElementById('vozrast').value,
        gorod: document.getElementById('gorod').value
      };

      if (tg.initDataUnsafe?.query_id) {
        // –î–ª—è Inline WebApp
        const query_id = tg.initDataUnsafe.query_id;
        const data = JSON.stringify(formData);
        
        // –§–æ—Ä–º–∏—Ä—É–µ–º URL —Å –¥–∞–Ω–Ω—ã–º–∏
        const redirectUrl = `https://t.me/${tg.initDataUnsafe.user.username}?startapp=webapp_${query_id}_${encodeURIComponent(data)}`;
        window.location.href = redirectUrl;
      } else {
        // –î–ª—è –æ–±—ã—á–Ω–æ–≥–æ WebApp (–Ω–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π)
        tg.sendData(JSON.stringify(formData));
        tg.close();
      }
    });
  </script>
</body>
</html>
